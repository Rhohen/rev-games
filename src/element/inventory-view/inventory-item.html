<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/marked-element/marked-element.html">
<dom-module id="inventory-item">
    <template>
        <style type="text/css">
        :host {
            display: block;
            padding: 10px;
        }
        </style>

    <iron-ajax id="ajaxLoader" url="{{url}}" handle-as="json" last-response="{{item}}"></iron-ajax>
    <div>[[label]]</div> 
    <marked-element markdown="{{itemMkdown}}">
        <div class="markdown-html"></div>
    </marked-element>
    <div>[[itemText]]</div>
    </template>

<script>
    Polymer({

        is: 'inventory-item',

        ready: function() {
        	this.$.ajaxLoader.addEventListener('iron-ajax-response', this.handleResponse.bind(this))
            if (!this.itemMediaId) {
                this.itemMkdown = "<img src='../../src/element/images/empty.png'>"
            }
        },

        handleResponse: function(response) {
        	this.fire('addItem', null)
            this.itemMkdown = response.detail.__data__.response.mkdown
            this.label = response.detail.__data__.label.mkdown
            this.itemText = response.detail.__data__.response.itemText
        },

        _loadPage: function(itemMediaId) {
            if (itemMediaId) {
                this.url = '/staticmedia/' + itemMediaId
                this.$.ajaxLoader.generateRequest()
            }
        },
        
        properties: {
            inventoryMediaid: {
                type: String,
                notify: true,
                observer: '_loadPage',
            },
            label: {
                type: String,
                notify: true,
            },
            itemText: {
                type: String,
                notify: true,
            },
            itemId: {
                type: String,
                notify: true,
            }
        },

    });
    </script>
</dom-module>